<html lang="zh">
<head>
    <title>Flow demo</title>
    <script src="flow-kit.js"></script>
    <script src="vue.js"></script>
    <script src="video.min.js"></script>
    <script src="axios.min.js"></script>
    <link rel="stylesheet" href="video-js.css">

    <style>
        body
        {
            margin: 0;
            padding: 0;
            user-select: none;
        }
        body table tbody
        {
            user-select: text;
        }
        button
        {
            user-select: none;
        }
        .c-gray
        {
            color: darkslategray
        }
        td
        {
            margin: 0;
            border: lightgray solid 1px;
        }
        .half-table
        {
            margin: 0;
            padding: 0;
            width: 49%;
            display: inline-block;
        }
    </style>
</head>
<body>
<h3 id="main-title">ä¸Šä¼ å’Œé¢„è§ˆæµ‹è¯•</h3>
<hr>
<div id="app" style="display: none" v-show="true">

    <div style="line-height: 100%">
        <table class="half-table">
            <tr>
                <td>é€‰æ‹©æ–‡ä»¶</td>
                <td>
                    <input type="file" ref="app-file" @change="changeFile()">
                </td>
            </tr>
            <tr>
                <td>æ–‡ä»¶ä¿¡æ¯</td>
                <td class="c-gray">
                    {{ filename }} <br>
                    {{ filesize }} B <br>
                    {{ (filesize / 1024).toFixed(2) }} KB <br>
                    {{ (filesize / 1024 / 1024).toFixed(2) }} MB <br>
                </td>
            </tr>
            <tr>
                <td>åˆ‡ç‰‡å¤§å°</td>
                <td>
                    <input type="number" v-model="sliceSize" min="10240" max="52428800"> B (10240~52428800) <br>
                    {{ (sliceSize / 1024).toFixed(2) }} KB <br>
                    {{ (sliceSize / 1024 / 1024).toFixed(2) }} MB <br>
                </td>
            </tr>
            <tr>
                <td>åˆ‡ç‰‡æ•°é‡</td>
                <td class="c-gray">
                    {{ sliceCount }}
                </td>
            </tr>
            <tr>
                <td>ä¸Šä¼ æ¡¶</td>
                <td>
                    <div>
                        <input type="text" v-model="inputPreview.nameBucket" placeholder="æ¡¶åç§° ä¸å¡«é»˜è®¤ä½¿ç”¨'jfb'">
                    </div>
                    <div class="c-gray">
                        ä¸Šä¼ åˆ° <b>MinIO</b> å’Œ <b>æ–‡ä»¶å‚¨å­˜</b> æ—¶éœ€è¦æŒ‡å®šä¸Šä¼ çš„æ¡¶åç§°. <br>
                        <b>æ¡¶</b> æ¦‚å¿µç±»ä¼¼æ–‡ä»¶å¤¹. <br>
                        ä¸ƒç‰›äº‘çš„æ¡¶ç©ºé—´æš‚æ—¶ä¸èƒ½é€šè¿‡åå°é…ç½®æˆ–è‡ªåŠ¨åˆ›å»º, éœ€è¦åœ¨ç½‘é¡µç«¯æ§åˆ¶å°æ‰‹åŠ¨é…ç½®. <br>
                    </div>
                </td>
            </tr>
            <tr>
                <td></td>
                <td>
                    <button @click="uploadFile('minio')">
                        ğŸ§¿ ä¸Šä¼ æ–‡ä»¶åˆ° MinIO
                    </button>
                    <button @click="uploadFile('qiniu')">
                        ğŸŒ¤ ä¸Šä¼ æ–‡ä»¶åˆ°ä¸ƒç‰›äº‘
                    </button>
                    <button @click="uploadFile('filesystem')">
                        ğŸ“¦ ä¸Šä¼ æ–‡ä»¶åˆ°æ–‡ä»¶å‚¨å­˜
                    </button>
                    <br>
                    <span class="c-gray">
                    ä¸‰ç§å‚¨å­˜æ–¹å¼å¯¹ç”¨æˆ·åŸºæœ¬é€æ˜
                </span>
                </td>
            </tr>
        </table>
        <table class="half-table">
            <tr>
                <td>é¢„è§ˆæ–‡ä»¶</td>
                <td>
                    <input type="text" placeholder="æ¡¶åç§°" v-model="inputPreview.nameBucket"> <br>
                    <input type="text" placeholder="æ–‡ä»¶åç§°" v-model="inputPreview.nameFile">
                </td>
                <td>
                    <button @click="changePreview('minio')">ğŸ§¿ åŠ è½½è‡ª MinIO</button> <br>
                    <button @click="changePreview('qiniu')">ğŸŒ¤ åŠ è½½è‡ªä¸ƒç‰›äº‘å…¬å…±ç©ºé—´</button> <br>
                    <button @click="changePreview('filesystem')">ğŸ“¦ åŠ è½½è‡ªæ–‡ä»¶å‚¨å­˜</button>
                </td>
            </tr>
            <tr>
                <td colspan="3" class="c-gray">
                    åŠ è½½è§†é¢‘æ–‡ä»¶è§„åˆ™:  ä»»åŠ¡id + '.m3u8'
                </td>
            </tr>
            <tr>
                <td>å½“å‰é¢„è§ˆ</td>
                <td colspan="2">
                    {{ currentPreview }}
                </td>
            </tr>
            <tr>
                <td colspan="3">
                    <div style="height: 340px; width: 600px" id="dom-player-parent">
                    </div>
                </td>
            </tr>
        </table>
    </div>

    <hr>

    <table class="half-table" style="text-align: center">
        <caption>å‰å°ä»»åŠ¡åˆ—è¡¨</caption>
        <thead>
        <tr>
            <th>
                åºåˆ—
            </th>
            <th>
                æ–‡ä»¶å
            </th>
            <th>
                æ–‡ä»¶å¤§å°
            </th>
            <th>
                åˆ‡ç‰‡å¤§å°
            </th>
            <th>
                ä¸Šä¼ ç›®æ ‡
            </th>
            <th>
                flow çŠ¶æ€
            </th>
            <th>å·¥ä½œæµ id</th>
            <th>
                æ“ä½œ
            </th>
        </tr>
        </thead>
        <tbody>
        <template v-if="listUpload.length">
            <tr v-for="(flow, index) in listUpload" :key="flow.id">
                <td>{{ index }}</td>
                <td>{{ flow.filename }}</td>
                <td>{{ flow.filesize }}</td>
                <td>{{ flow.sliceSize }}</td>
                <td>{{ flow.target }}</td>
                <td>
                    <span v-if="flow.uploadCount === -1">ä¸Šä¼ å®Œæˆ</span>
                    <span v-else-if="flow.uploadCount === -2">å–æ¶ˆä¸Šä¼ </span>
                    <span v-else-if="flow.uploadCount === -3">ä¸Šä¼ å¤±è´¥</span>
                    <span v-else-if="flow.uploadCount === -4">å‡†å¤‡ä¸Šä¼ </span>
                    <span v-else>
                        {{ flow.sliceCount }} / {{ flow.uploadCount }}
                    </span>
                </td>
                <td>{{ flow.idWorkflow }}</td>
                <td>
                    <button v-if="flow.uploadCount >= 0"
                            @click="stopUpload(flow)">ä¸­æ­¢ä¸Šä¼ </button>
                    <button v-if="flow.uploadCount < 0"
                            @click="listUpload.splice(index, 1)">åˆ é™¤</button>
                </td>
            </tr>
        </template>
        <tr v-else>
            <td colspan="7">
                flow åˆ—è¡¨ä¸ºç©º
            </td>
        </tr>
        </tbody>
    </table>
    <table class="half-table">
        <caption>
            <div>åå°å·¥ä½œæµåˆ—è¡¨</div>
            <div style="color: #16379f">
                <label for="cb-refresh-list-workflow">è‡ªåŠ¨åˆ·æ–°åˆ—è¡¨</label>
                <input type="checkbox"
                       id="cb-refresh-list-workflow"
                       v-model="shouldRefreshListWorkflow">
            </div>
            <button @click="refreshListWorkflow">åˆ·æ–°</button>
        </caption>
        <thead>
        <tr>
            <th>å·¥ä½œæµid</th>
            <th>å·¥ä½œæµå½“å‰ä»»åŠ¡</th>
            <th>æ“ä½œ</th>
        </tr>
        </thead>
        <tbody>
        <template v-if="isRefreshingListWorkflow">
            <tr>
                <td colspan="4">æ­£åœ¨åŠ è½½å·¥ä½œæµåˆ—è¡¨</td>
            </tr>
        </template>
        <template v-else-if="listWorkflow.length">
            <tr v-for="workflow in listWorkflow" :key="workflow.id">
                <td> {{ workflow.id }} </td>
                <td> {{ workflow.status }} </td>
                <td> <button @click="deleteWorkflow(workflow.id)">åˆ é™¤</button> </td>
            </tr>
        </template>
        <template v-else>
            <tr>
                <td colspan="4">å½“å‰åå°å·¥ä½œæµåˆ—è¡¨ä¸ºç©º</td>
            </tr>
        </template>
        </tbody>
    </table>
</div>

<script>
    const isLocal = window.location.href.toString().startsWith('file://');
    if(isLocal)
    {
        document.title = 'æµ‹è¯•é¡µé¢(æœ¬åœ°æ¨¡å¼)';
        document.getElementById('main-title').innerText = 'ä¸Šä¼ å’Œé¢„è§ˆæµ‹è¯• (æœ¬åœ°æ¨¡å¼. æ­¤æ¨¡å¼å¯èƒ½å¤§éƒ¨åˆ†åŠŸèƒ½ä¸èƒ½æ­£å¸¸è¿è¡Œ)';
    }
</script>
</body>
<script src="flow-demo.js"></script>
</html>
